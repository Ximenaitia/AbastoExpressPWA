trigger:
  branches:
    include:
    - master

pool: 'MyAgentPool'

stages:

# BUILD GENERAL - Todas las funcionalidades
- stage: Build_All
  displayName: '📦 BUILD - Todas las funcionalidades'
  jobs:
  - job: Build_All_Functionalities
    steps:
    - script: echo "Compilando dependencias de seguridad - US001"
      displayName: 'US001: Build seguridad'
    - script: echo "Compilando módulo productos con catálogo - US002"
      displayName: 'US002: Build productos'
    - script: echo "Compilando módulo inventario con estados - US003"
      displayName: 'US003: Build inventario'
    - script: echo "Compilando app móvil con módulo pedidos - US004"
      displayName: 'US004: Build pedidos'

# TEST GENERAL - Todas las funcionalidades
- stage: Test_All
  displayName: '🧪 TEST - Todas las funcionalidades'
  dependsOn: Build_All
  jobs:
  - job: Test_All_Functionalities
    steps:
    - script: echo "Ejecutando pruebas unitarias de seguridad - US001"
      displayName: 'US001: Test seguridad login'
    - script: echo "Ejecutando pruebas API CRUD productos - US002"
      displayName: 'US002: Test API productos'
    - script: echo "Ejecutando pruebas automatizadas inventario - US003"
      displayName: 'US003: Test inventario'
    - script: echo "Ejecutando pruebas estados pedido - US004"
      displayName: 'US004: Test estados pedido'

# DEPLOY GENERAL - Todas las funcionalidades
- stage: Deploy_All
  displayName: '🚀 DEPLOY - Todas las funcionalidades'
  dependsOn: Test_All
  jobs:
  - job: Deploy_All_Functionalities
    steps:
    - script: echo "Desplegando a staging con configuración segura - US001"
      displayName: 'US001: Deploy auth'
    - script: echo "Desplegando contenedores Docker para productos - US002"
      displayName: 'US002: Deploy productos'
    - script: echo "Desplegando contenedores Kubernetes - US003"
      displayName: 'US003: Deploy inventario'
    - script: echo "Desplegando app móvil a stores - US004"
      displayName: 'US004: Deploy pedidos'

# MONITOREO GENERAL - Todas las funcionalidades
- stage: Monitor_All
  displayName: '📊 MONITOR - Todas las funcionalidades'
  dependsOn: Deploy_All
  jobs:
  - job: Monitor_All_Functionalities
    steps:
    - script: echo "Configurando alertas de autenticación - US001"
      displayName: 'US001: Monitor auth'
    - script: echo "Monitoreo consultas catálogo - US002"
      displayName: 'US002: Monitor productos'
    - script: echo "Alertas rendimiento existencias - US003"
      displayName: 'US003: Monitor inventario'
    - script: echo "Monitoreo errores pedidos - US004"
      displayName: 'US004: Monitor pedidos'
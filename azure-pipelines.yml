trigger:
- master

pool: 'MyAgentPool'

stages:

# US001 - AUTENTICACIÓN
- stage: Build_US001_Auth
  displayName: '📦 BUILD US001 - Autenticación'
  jobs:
  - job: Build_Auth
    steps:
    - script: echo "Compilando dependencias de seguridad - US001-T2"
      displayName: 'US001-T2: Build dependencias seguridad'

- stage: Test_US001_Auth  
  displayName: '🧪 TEST US001 - Autenticación'
  jobs:
  - job: Test_Auth
    steps:
    - script: echo "Ejecutando pruebas unitarias de seguridad - US001-T3"
      displayName: 'US001-T3: Test seguridad login'

- stage: Deploy_US001_Auth
  displayName: '🚀 DEPLOY US001 - Autenticación'
  jobs:
  - job: Deploy_Auth
    steps:
    - script: echo "Desplegando a staging con configuración segura - US001-T4"
      displayName: 'US001-T4: Deploy staging seguro'

# US002 - PRODUCTOS  
- stage: Build_US002_Products
  displayName: '📦 BUILD US002 - Productos'
  jobs:
  - job: Build_Products
    steps:
    - script: echo "Compilando módulo productos con catálogo - US002-T2"
      displayName: 'US002-T2: Build módulo productos'

- stage: Test_US002_Products
  displayName: '🧪 TEST US002 - Productos'
  jobs:
  - job: Test_Products
    steps:
    - script: echo "Ejecutando pruebas API CRUD productos - US002-T3"
      displayName: 'US002-T3: Test API productos'

- stage: Deploy_US002_Products
  displayName: '🚀 DEPLOY US002 - Productos'
  jobs:
  - job: Deploy_Products
    steps:
    - script: echo "Desplegando contenedores Docker para productos - US002-T4"
      displayName: 'US002-T4: Deploy Docker productos'

# US003 - INVENTARIO
- stage: Build_US003_Inventory
  displayName: '📦 BUILD US003 - Inventario'
  jobs:
  - job: Build_Inventory
    steps:
    - script: echo "Compilando módulo inventario con estados - US003-T2"
      displayName: 'US003-T2: Build inventario estados'

- stage: Test_US003_Inventory
  displayName: '🧪 TEST US003 - Inventario'
  jobs:
  - job: Test_Inventory
    steps:
    - script: echo "Ejecutando pruebas automatizadas inventario - US003-T3"
      displayName: 'US003-T3: Test inventario automatizado'

- stage: Deploy_US003_Inventory
  displayName: '🚀 DEPLOY US003 - Inventario'
  jobs:
  - job: Deploy_Inventory
    steps:
    - script: echo "Desplegando contenedores Kubernetes - US003-T4"
      displayName: 'US003-T4: Deploy Kubernetes'

# US004 - PEDIDOS
- stage: Build_US004_Orders
  displayName: '📦 BUILD US004 - Pedidos'
  jobs:
  - job: Build_Orders
    steps:
    - script: echo "Compilando app móvil con módulo pedidos - US004-T2"
      displayName: 'US004-T2: Build app móvil pedidos'

- stage: Test_US004_Orders
  displayName: '🧪 TEST US004 - Pedidos'
  jobs:
  - job: Test_Orders
    steps:
    - script: echo "Ejecutando pruebas estados pedido - US004-T3"
      displayName: 'US004-T3: Test estados pedido'

- stage: Deploy_US004_Orders
  displayName: '🚀 DEPLOY US004 - Pedidos'
  jobs:
  - job: Deploy_Orders
    steps:
    - script: echo "Desplegando app móvil a stores - US004-T4"
      displayName: 'US004-T4: Deploy app móvil'

# MONITOREO GENERAL (Todas las T5)
- stage: Monitor_All
  displayName: '📊 MONITOR - Todas las Alertas'
  jobs:
  - job: Monitor
    steps:
    - script: echo "Configurando alertas de autenticación - US001-T5"
      displayName: 'US001-T5: Monitor alertas auth'
    - script: echo "Monitoreo consultas catálogo - US002-T5"
      displayName: 'US002-T5: Monitor consultas catálogo'
    - script: echo "Alertas rendimiento existencias - US003-T5"
      displayName: 'US003-T5: Monitor existencias'
    - script: echo "Monitoreo errores pedidos - US004-T5"
      displayName: 'US004-T5: Monitor errores pedidos'
